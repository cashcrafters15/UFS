<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employee Joining Form</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h2>Employee Joining Form</h2>
    <form id="joiningForm">
      <label>Full Name</label>
      <input type="text" name="fullName" required>

      <label>Mobile</label>
      <input type="text" name="mobile" required>

      <label>Work Location</label>
      <input type="text" name="workLocation" required>

      <label>Designation</label>
      <input type="text" name="designation" required>

      <label>Photo</label>
      <input type="file" name="photo" accept="image/*" required>

      <label>Aadhaar Front</label>
      <input type="file" name="aadhaarFront" accept="image/*" required>

      <label>Aadhaar Back</label>
      <input type="file" name="aadhaarBack" accept="image/*" required>

      <label>PAN</label>
      <input type="file" name="pan" accept="image/*" required>

      <label>Bank Document</label>
      <input type="file" name="bank" accept="image/*" required>

      <button type="submit">Submit</button>
    </form>

    <div id="result"></div>
    <div id="pdfPreview" style="margin-top:20px; display:none;">
      <h3>Preview:</h3>
      <iframe id="pdfFrame" width="100%" height="600px"></iframe>
    </div>
  </div>

  <script>
    const form = document.getElementById("joiningForm");
    const resultDiv = document.getElementById("result");
    const pdfPreviewDiv = document.getElementById("pdfPreview");
    const pdfFrame = document.getElementById("pdfFrame");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const formData = new FormData(form);

      const filesToBase64 = async (file) => {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.readAsDataURL(file);
          reader.onload = () => resolve(reader.result);
          reader.onerror = (error) => reject(error);
        });
      };

      const data = {
        fullName: formData.get("fullName"),
        mobile: formData.get("mobile"),
        workLocation: formData.get("workLocation"),
        designation: formData.get("designation"),
        photo: await filesToBase64(formData.get("photo")),
        aadhaarFront: await filesToBase64(formData.get("aadhaarFront")),
        aadhaarBack: await filesToBase64(formData.get("aadhaarBack")),
        pan: await filesToBase64(formData.get("pan")),
        bank: await filesToBase64(formData.get("bank"))
      };

      resultDiv.innerHTML = "Submitting... Please wait.";

      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbyYnTA74ykhDDcP1rZAAj7MmLPGN9BT5Ek300ifJmI/dev", {
          method: "POST",
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if(result.status === "success") {
          resultDiv.innerHTML = `<p>Form submitted successfully! Employee ID: <b>${result.empId}</b></p>`;
          pdfFrame.src = result.pdfUrl;
          pdfPreviewDiv.style.display = "block";
          form.reset();
        } else {
          resultDiv.innerHTML = `<p>Error: ${result.message}</p>`;
          pdfPreviewDiv.style.display = "none";
        }
      } catch(err) {
        resultDiv.innerHTML = `<p>Submission failed: ${err}</p>`;
        pdfPreviewDiv.style.display = "none";
      }
    });
  </script>
</body>
</html>

