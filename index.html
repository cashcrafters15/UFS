<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Employee Joining Form</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="style.css">
</head>

<body>
<div class="container mt-4">
  <h3 class="text-center mb-3">Employee Joining Form</h3>

  <div id="msg" class="alert d-none"></div>

  <form id="form">
    <input class="form-control mb-2" name="fullName" placeholder="Full Name" required>
    <input class="form-control mb-2" name="mobile" placeholder="Mobile Number" required>
    <input class="form-control mb-2" name="workLocation" placeholder="Work Location" required>
    <input class="form-control mb-2" name="designation" placeholder="Designation" required>

    <label>Photo</label>
    <input type="file" id="photo" class="form-control mb-2" required>

    <label>Aadhaar Front</label>
    <input type="file" id="aadhaarFront" class="form-control mb-2" required>

    <label>Aadhaar Back</label>
    <input type="file" id="aadhaarBack" class="form-control mb-2" required>

    <label>PAN</label>
    <input type="file" id="pan" class="form-control mb-2" required>

    <label>Bank Proof</label>
    <input type="file" id="bank" class="form-control mb-3" required>

    <button class="btn btn-primary w-100" id="btn">Submit</button>
  </form>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyRACCrDRpgJVLU0dMlLnba_6tiYJB5sEk8JI_QSfNLOuTkGQU0myO6O7NidxaK1CSE/exec";

document.getElementById("form").addEventListener("submit", async e => {
  e.preventDefault();
  const msg = document.getElementById("msg");
  const btn = document.getElementById("btn");

  msg.className = "alert alert-info";
  msg.innerText = "Submitting, please wait...";
  msg.classList.remove("d-none");
  btn.disabled = true;

  try {
    const data = {
      action: "submit",
      fullName: form.fullName.value,
      mobile: form.mobile.value,
      workLocation: form.workLocation.value,
      designation: form.designation.value,
      photo: await toBase64(photo.files[0]),
      aadhaarFront: await toBase64(aadhaarFront.files[0]),
      aadhaarBack: await toBase64(aadhaarBack.files[0]),
      pan: await toBase64(pan.files[0]),
      bank: await toBase64(bank.files[0])
    };

    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    const json = await res.json();

    if (json.status !== "success") throw json.message;

    msg.className = "alert alert-success";
    msg.innerHTML = `Submitted Successfully âœ…<br><b>Employee ID:</b> ${json.empId}`;
    form.reset();

  } catch (err) {
    msg.className = "alert alert-danger";
    msg.innerText = err;
  }

  btn.disabled = false;
});

function toBase64(file) {
  return new Promise((resolve, reject) => {
    const r = new FileReader();
    r.onload = () => resolve(r.result);
    r.onerror = reject;
    r.readAsDataURL(file);
  });
}
</script>
</body>
</html>
