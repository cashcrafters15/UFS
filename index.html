<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Joining Form | Unified Security</title>
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- AOS Animation -->
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<style>
/* ----- MODERN FORM STYLE ----- */
body { font-family: 'Segoe UI', sans-serif; background:#f5f7fa; padding-top:80px; }
.navbar { background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
.navbar .brand-text { font-weight:600; font-size:1.2rem; margin-left:10px; }
.navbar-brand img { height: 40px; width: auto; object-fit: contain; } /* Logo Styling */
.main-wrapper { max-width:900px; margin:auto; }
.paper-card { background:#fff; border-radius:12px; padding:30px; box-shadow:0 4px 20px rgba(0,0,0,0.08); margin-bottom:40px; }
.paper-header h2 { font-weight:700; color:#003366; font-size: 1.5rem; }
.paper-header h5 { font-weight:500; color:#555; margin-bottom:5px; }
.asterisk { font-size:0.9rem; color:#ff0000; }
.paper-section { margin-top:25px; }
.paper-input, .paper-textarea, .paper-select { width:100%; padding:10px 12px; border:1px solid #ccc; border-radius:6px; transition:0.3s; }
.paper-input:focus, .paper-textarea:focus, .paper-select:focus { outline:none; border-color:#007bff; box-shadow:0 0 8px rgba(0,123,255,0.2); }
.paper-textarea { resize:none; }
.paper-table { width:100%; border-collapse:collapse; margin-top:10px; }
.paper-table th, .paper-table td { border:1px solid #ddd; padding:10px; text-align:left; }
.paper-table th { background:#007bff; color:#fff; }
.table-input { width:100%; padding:6px; border-radius:4px; border:1px solid #ccc; }
.btn-submit { background:#007bff; color:#fff; padding:10px 20px; border:none; border-radius:6px; font-weight:600; transition:0.3s; }
.btn-submit:hover { background:#0056b3; }
.photo-upload-box { width:150px; height:150px; margin:auto; border:2px dashed #ccc; border-radius:8px; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:0.3s; background:#f9f9f9; }
.photo-upload-box:hover { background:#e9ecef; }
.photo-placeholder i { color:#666; }
.hidden { display:none; }
.alert { padding:12px; border-radius:6px; margin-bottom:15px; }
.upload-section .paper-input { padding:6px; }
.warning-box { background:#fff3cd; border-left:5px solid #ffeeba; padding:15px; border-radius:6px; margin-top:20px; }
.undertaking-box { background:#f1f5f9; padding:20px; border-radius:8px; margin-top:25px; }
.signatures { display:flex; gap:20px; margin-top:15px; }
.sig-box { flex:1; }
.underline-input { border:none; border-bottom:2px solid #333; width:100%; padding:5px; background:transparent; font-weight:bold; color:#000; } /* Bold signature text */
.sig-locked { text-align:center; }
.sig-locked .locked-sig span { font-size:0.9rem; color:#555; display:block; }
.sig-locked .locked-sig img { height: 50px; width: auto; margin-top: 5px; object-fit: contain; } /* Image styling for signature */
.hero-particles { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; pointer-events:none; }
.particle { position:absolute; width:8px; height:8px; background:rgba(0,123,255,0.4); border-radius:50%; animation: float 15s linear infinite; }
@keyframes float { 0% { transform:translateY(0);} 50% { transform:translateY(-200px);} 100% { transform:translateY(0);} }
</style>
</head>
<body>

<div class="hero-particles" id="heroParticles"></div>

<nav class="navbar navbar-expand-lg fixed-top navbar-light">
    <div class="container">
        <a class="navbar-brand" href="#">
            <!-- CHANGED: Logo Source to GitHub Favicon -->
            <img src="https://github.com/fluidicon.png" alt="Unified" height="40">
            <span class="brand-text">Joining Form</span>
        </a>
    </div>
</nav>

<div class="main-wrapper">
<div class="paper-card" data-aos="fade-up" data-aos-duration="1000">

<div class="paper-header">
<h2>UNIFIED SECURITY AND FACILITIES MANAGEMENT SERVICES PVT. LTD.</h2>
<h5>Joining / General Information Form</h5>
<p class="asterisk">*All details should be as per Aadhaar Card</p>
</div>

<div class="paper-body">
<form id="joiningForm">

<div id="statusMsg" class="alert hidden"></div>

<!-- SECTION 1: TOP ROW -->
<div class="paper-section">
<div class="row g-3 align-items-start">
<div class="col-md-8">
<label class="form-label-bold">Name of Employee: *</label>
<!-- ADDED ID 'fullNameInput' to read this value for the signature -->
<input type="text" class="paper-input" name="fullName" id="fullNameInput" required>

<div class="row mt-3">
<div class="col-md-6">
<label class="form-label-bold">UAN No:</label>
<input type="text" class="paper-input" name="uan">
</div>
<div class="col-md-6">
<label class="form-label-bold">Work Location: *</label>
<input type="text" class="paper-input" name="workLocation" required>
</div>
</div>

<div class="row mt-3">
<div class="col-md-6">
<label class="form-label-bold">Designation: *</label>
<input type="text" class="paper-input" name="designation" required>
</div>
<div class="col-md-6 d-flex flex-column">
<label class="form-label-bold">Gender:</label>
<div class="d-flex gap-3">
<div class="form-check">
<input class="form-check-input" type="radio" name="gender" value="Male" required>
<label class="form-check-label">Male</label>
</div>
<div class="form-check">
<input class="form-check-input" type="radio" name="gender" value="Female">
<label class="form-check-label">Female</label>
</div>
</div>
</div>
</div>

<div class="row mt-3">
<div class="col-md-6">
<label class="form-label-bold">Date of Birth: *</label>
<input type="date" class="paper-input" name="dob" required>
</div>
<div class="col-md-6">
<label class="form-label-bold">Joining Date: *</label>
<input type="date" class="paper-input" name="joiningDate" required>
</div>
</div>

<div class="mt-4">
<label class="form-label-bold">Father / Husband Name: *</label>
<input type="text" class="paper-input" name="fatherName" required>
</div>
</div>

<div class="col-md-4 text-center">
<label class="form-label-bold">Photo</label>
<div class="photo-upload-box" id="photoPreviewBox">
<input type="file" id="photoInput" accept="image/*" required hidden>
<div class="photo-placeholder" onclick="document.getElementById('photoInput').click()">
<i class="fas fa-camera fa-2x"></i>
<p>Click to Upload</p>
</div>
</div>
</div>
</div>
</div>

<!-- SECTION 2: NOMINEE & CONTACT -->
<div class="paper-section">
<div class="row g-3">
<div class="col-md-6">
<label class="form-label-bold">Nominee Name:</label>
<input type="text" class="paper-input" name="nomineeName">
</div>
<div class="col-md-3">
<label class="form-label-bold">Relation:</label>
<input type="text" class="paper-input" name="nomineeRelation">
</div>
<div class="col-md-3">
<label class="form-label-bold">Marital Status:</label>
<select class="paper-input" name="maritalStatus">
<option value="Single">Single</option>
<option value="Married">Married</option>
</select>
</div>
</div>

<div class="row mt-3">
<div class="col-md-4">
<label class="form-label-bold">Mobile No: *</label>
<input type="tel" class="paper-input" name="mobile" pattern="[0-9]{10}" required>
</div>
<div class="col-md-4">
<label class="form-label-bold">Aadhaar No: *</label>
<input type="text" class="paper-input" name="aadhaar" required>
</div>
<div class="col-md-4">
<label class="form-label-bold">PAN No: *</label>
<input type="text" class="paper-input" name="pan" required>
</div>
</div>
</div>

<!-- SECTION 3: BANK -->
<div class="paper-section">
<div class="row g-3">
<div class="col-md-6">
<label class="form-label-bold">Bank Account No: *</label>
<input type="text" class="paper-input" name="bankAccount" required>
</div>
<div class="col-md-6">
<label class="form-label-bold">IFSC: *</label>
<input type="text" class="paper-input" name="ifsc" required>
</div>
</div>
</div>

<!-- SECTION 4: ADDRESS -->
<div class="paper-section">
<label class="form-label-bold">Present Address: *</label>
<textarea class="paper-textarea" name="presentAddress" rows="2" required></textarea>

<label class="form-label-bold mt-3">Permanent Address: *</label>
<textarea class="paper-textarea" name="permanentAddress" rows="2" required></textarea>
</div>

<!-- SECTION 5: UNIFORM ISSUE -->
<div class="paper-section">
<label class="form-label-bold">Uniform Issue Status</label>
<div class="table-responsive">
<table class="paper-table modern-table">
<thead>
<tr>
<th>Item Name</th>
<th style="width: 20%;">Issued?</th>
<th>Issue Date</th>
</tr>
</thead>
<tbody>
<tr>
<td>Pant</td>
<td><div class="form-check form-switch"><input class="form-check-input uniform-switch" type="checkbox" role="switch"></div></td>
<td><input type="date" class="table-input date-field" disabled></td>
</tr>
<tr>
<td>Shirt</td>
<td><div class="form-check form-switch"><input class="form-check-input uniform-switch" type="checkbox" role="switch"></div></td>
<td><input type="date" class="table-input date-field" disabled></td>
</tr>
<tr>
<td>Shoes</td>
<td><div class="form-check form-switch"><input class="form-check-input uniform-switch" type="checkbox" role="switch"></div></td>
<td><input type="date" class="table-input date-field" disabled></td>
</tr>
<tr>
<td>Cap</td>
<td><div class="form-check form-switch"><input class="form-check-input uniform-switch" type="checkbox" role="switch"></div></td>
<td><input type="date" class="table-input date-field" disabled></td>
</tr>
<tr>
<td>Belt</td>
<td><div class="form-check form-switch"><input class="form-check-input uniform-switch" type="checkbox" role="switch"></div></td>
<td><input type="date" class="table-input date-field" disabled></td>
</tr>
<tr>
<td>Line Yard</td>
<td><div class="form-check form-switch"><input class="form-check-input uniform-switch" type="checkbox" role="switch"></div></td>
<td><input type="date" class="table-input date-field" disabled></td>
</tr>
<tr>
<td>Whistle</td>
<td><div class="form-check form-switch"><input class="form-check-input uniform-switch" type="checkbox" role="switch"></div></td>
<td><input type="date" class="table-input date-field" disabled></td>
</tr>
<tr>
<td>Tie</td>
<td><div class="form-check form-switch"><input class="form-check-input uniform-switch" type="checkbox" role="switch"></div></td>
<td><input type="date" class="table-input date-field" disabled></td>
</tr>
<tr>
<td>I-Card</td>
<td><div class="form-check form-switch"><input class="form-check-input uniform-switch" type="checkbox" role="switch"></div></td>
<td><input type="date" class="table-input date-field" disabled></td>
</tr>
<tr>
<td>Flap</td>
<td><div class="form-check form-switch"><input class="form-check-input uniform-switch" type="checkbox" role="switch"></div></td>
<td><input type="date" class="table-input date-field" disabled></td>
</tr>
</tbody>
</table>
</div>
</div>

<!-- SECTION 6: ESIC NUMBER -->
<div class="paper-section">
<label class="form-label-bold">ESIC Number of Employee:</label>
<input type="text" class="paper-input mb-3" name="esic">
</div>

<!-- SECTION 7: UNDERTAKING -->
<div class="undertaking-box">
<h5>Undertaking</h5>
<p>मैं, नीचे हस्ताक्षरित, प्रमाणित करता हूँ कि मेरे द्वारा दिए गए ऊपर के विवरण मेरी जानकारी के अनुसार सही और सत्य हैं। अगर मेरे पास UAN और बैंक अकाउंट नहीं है तो सैलरी नहीं दी जाएगी।</p>

<div class="signatures">
<div class="sig-box">
<p>Signature/Thumb of Employee</p>
<!-- ADDED ID 'employeeSignature' -->
<input type="text" class="underline-input" id="employeeSignature" placeholder="Will Auto-fill" readonly>
</div>
<div class="sig-box sig-locked">
<p>Authorised Signatory</p>
<div class="locked-sig">
<span>For Unified Security</span>
<!-- CHANGED: Using GitHub Favicon Image -->
<img src="https://github.com/fluidicon.png" alt="Authorised Signatory">
</div>
</div>
</div>
</div>

<!-- SECTION 8: DOCUMENT UPLOADS -->
<div class="paper-section mt-4 upload-section">
<label class="form-label-bold">Upload Required Documents *</label>
<div class="row g-3">
<div class="col-md-6">
<label class="small text-muted">1. Passport Size Photo</label>
<input type="file" class="paper-input doc-upload" id="doc1" accept="image/*" required>
</div>
<div class="col-md-6">
<label class="small text-muted">2. Aadhaar Card Front</label>
<input type="file" class="paper-input doc-upload" id="doc2" accept="image/*" required>
</div>
<div class="col-md-6">
<label class="small text-muted">3. Aadhaar Card Back</label>
<input type="file" class="paper-input doc-upload" id="doc3" accept="image/*" required>
</div>
<div class="col-md-6">
<label class="small text-muted">4. PAN Card Image</label>
<input type="file" class="paper-input doc-upload" id="doc4" accept="image/*" required>
</div>
<div class="col-md-6">
<label class="small text-muted">5. Bank Account Passbook/Image</label>
<input type="file" class="paper-input doc-upload" id="doc5" accept="image/*,.pdf" required>
</div>
<div class="col-md-6">
<label class="small text-muted">6. ESIC Card (If available)</label>
<input type="file" class="paper-input doc-upload" id="doc6" accept="image/*,.pdf">
</div>
</div>
</div>

<!-- FINAL WARNING DECLARATION -->
<div class="warning-box">
<h4 class="text-danger"><i class="fas fa-exclamation-triangle"></i> LEGAL WARNING</h4>
<p><strong>Declaration:</strong> If any information or documents provided here are found to be fraudulent, fake, or misleading, strict disciplinary action will be taken and financial penalty will be imposed as per company policy and law.</p>
</div>

<div class="text-center mt-4">
<button type="submit" id="submitBtn" class="btn btn-submit">
<i class="fas fa-check-double me-2"></i> Submit Form
</button>
</div>

</form>
</div>
</div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
AOS.init({once:true,duration:800});

// LOGIC: Auto-fill Employee Signature with Employee Name
const fullNameInput = document.getElementById('fullNameInput');
const employeeSignature = document.getElementById('employeeSignature');

if(fullNameInput && employeeSignature){
    fullNameInput.addEventListener('input', function() {
        employeeSignature.value = this.value;
    });
}

// Uniform Table Logic
document.querySelectorAll('.uniform-switch').forEach(sw=>{
    sw.addEventListener('change',function(){
        const row=this.closest('tr');
        const date=row.querySelector('.date-field');
        if(this.checked){ 
            date.disabled=false; 
            date.focus(); 
            // Default to today
            date.valueAsDate = new Date();
        } else { 
            date.disabled=true; 
            date.value=''; 
        }
    });
});

// Photo Preview
const photoInput=document.getElementById('photoInput');
const photoPlaceholder=document.querySelector('.photo-placeholder');
photoInput.addEventListener('change',function(){
    const file=this.files[0];
    if(file){
        const reader=new FileReader();
        reader.onload=function(e){
            photoPlaceholder.innerHTML=`<img src="${e.target.result}" style="width:100%;height:100%;object-fit:cover;border-radius:8px;">`;
        }
        reader.readAsDataURL(file);
    }
});

// Helper to convert file to Base64
function toBase64(file){
    return new Promise((resolve,reject)=>{
        const reader=new FileReader();
        reader.readAsDataURL(file);
        reader.onload=()=>resolve(reader.result);
        reader.onerror=err=>reject(err);
    });
}

// Form Submit
const SCRIPT_URL='https://script.google.com/macros/s/AKfycbyBaFQIr9PtvIsIM3f10EAFOqeM9JCuvjyMGlcdlKFBVLI6lmCcMlhjpfBXbF7KAF-e/exec';

document.getElementById('joiningForm').addEventListener('submit',async function(e){
    e.preventDefault();
    const btn=document.getElementById('submitBtn');
    const msg=document.getElementById('statusMsg');
    
    btn.disabled=true; 
    btn.innerHTML='<i class="fas fa-spinner fa-spin me-2"></i> Submitting...';
    msg.className='alert alert-info hidden'; 
    msg.innerText="Please wait while we upload your files...";
    msg.classList.remove('hidden');
    
    const formData=new FormData(this);
    const data={};
    formData.forEach((v,k)=>data[k]=v);
    
    // 1. Process Uniform Data
    const uniformRows=[];
    document.querySelectorAll('.modern-table tbody tr').forEach(row=>{
        const isIssued=row.querySelector('.uniform-switch').checked;
        if(isIssued){ 
            uniformRows.push({
                item:row.cells[0].innerText.trim(),
                date:row.querySelector('.date-field').value
            }); 
        }
    });
    data.uniformDetails=uniformRows;
    
    // 2. Process Files (Base64)
    const filePromises=[];
    
    // Fix: We map 'photoInput' ID to 'photoInput' key in data to match the script
    if(photoInput.files[0]) {
        filePromises.push(
            toBase64(photoInput.files[0]).then(res => ({name:'photoInput', data:res}))
        );
    }
    
    for(let i=1;i<=6;i++){
        const input=document.getElementById('doc'+i);
        if(input.files[0]) {
            filePromises.push(
                toBase64(input.files[0]).then(res => ({name:'doc'+i, data:res}))
            );
        }
    }

    try{
        // Wait for all files to be converted
        const files=await Promise.all(filePromises);
        
        // Add file data to main data object
        files.forEach(f=>data[f.name]=f.data);
        
        data.action='submitForm';

        // Send to Google Apps Script
        await fetch(SCRIPT_URL,{
            method:'POST',
            mode:'no-cors', // Important for GAS
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify(data)
        });
        
        btn.innerHTML='<i class="fas fa-check me-2"></i> Submitted';
        btn.classList.remove('btn-submit');
        btn.classList.add('btn-success');
        msg.className='alert alert-success';
        msg.innerHTML=`<strong>Success!</strong><br>Your form has been submitted.`;
        
        // Reset Form
        this.reset();
        photoPlaceholder.innerHTML='<i class="fas fa-camera fa-2x"></i><p>Click to Upload</p>';
        document.querySelectorAll('.date-field').forEach(i=>{i.disabled=true; i.value='';});
        employeeSignature.value = ''; // Reset signature field
        
    }catch(err){
        console.error(err);
        btn.disabled=false;
        btn.innerHTML='Error - Try Again';
        btn.classList.remove('btn-submit');
        btn.classList.add('btn-danger');
        msg.className='alert alert-danger';
        msg.innerText="Error submitting form. Please check your internet connection or contact support.";
    }
});

// Particles
function createParticles(){
    const container=document.getElementById('heroParticles');
    if(!container) return;
    container.innerHTML = ''; // Clear previous
    for(let i=0;i<30;i++){
        let p=document.createElement('div');
        p.className='particle';
        p.style.left=Math.random()*100+'%';
        p.style.top=Math.random()*100+'%';
        p.style.animationDelay=Math.random()*20+'s';
        container.appendChild(p);
    }
}
document.addEventListener('DOMContentLoaded',createParticles);
</script>
</body>
</html>
